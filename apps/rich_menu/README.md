# リッチメニューシステム

LINE Botのリッチメニュー機能を実装したモジュールです。

## 📁 ディレクトリ構成

```
apps/rich_menu/
├── __init__.py              # モジュール初期化
├── menu_manager.py          # リッチメニューCRUD操作
├── menu_templates.py        # メニュー定義・ヒットボックス
├── commands.py              # 管理コマンド
├── richmenu_page1.html      # ページ1デザイン（参考用）
├── richmenu_page2.html      # ページ2デザイン（参考用）
├── README.md                # このファイル
└── images/
    ├── rich_menu_page_1-1_account.png   # ページ1-1: 口座管理（2500x1686px）
    ├── rich_menu_page_1-2_shop.png      # ページ1-2: ショップ（2500x1686px）
    ├── rich_menu_page_1-3_stock.png     # ページ1-3: 株式（2500x1686px）
    ├── rich_menu_page_2-1_game.png      # ページ2-1: ゲーム（2500x1686px）
    ├── rich_menu_page_2-2_utility.png   # ページ2-2: ユーティリティ（2500x1686px）
    └── rich_menu_page_2-3_help.png      # ページ2-3: ヘルプ（2500x1686px）
```

## 🎨 メニュー構成

### ページ1: メインページ（3画面）

#### 1-1: 口座管理
- 💰 口座開設
- 📖 通帳
- 💸 振り込み

#### 1-2: ショップ
- 🛒 ショップホーム
- 💎 チップ残高
- 💵 チップ換金

#### 1-3: 株式システム
- 📊 株式ダッシュボード
- 📋 銘柄一覧
- 📈 保有株一覧
- 📰 市場ニュース

### ページ2: サブページ（3画面）

#### 2-1: ゲーム
- 🎮 ゲームメニュー
- 💎 チップ一覧
- 💵 チップ換金

#### 2-2: ユーティリティ
- 🔮 おみくじ
- 📅 明日の時間割
- 💼 労働

#### 2-3: ヘルプ
- ❓ ヘルプ
- 💰 口座関連ヘルプ
- 📈 株式システムヘルプ

### ナビゲーション
各画面上部にタブがあり、ページ間を自由に移動できます。
- ページ1: 口座管理 | ショップ | 株式 | ▶️次へ
- ページ2: ◀️前へ | ゲーム | ユーティリティ | ヘルプ

## 🚀 セットアップ手順

### 1. 画像の準備

HTMLファイル（`richmenu_page1.html`, `richmenu_page2.html`）をブラウザで開き、**2500x1686px**でスクリーンショットを撮影します。

**推奨方法:**
- ブラウザのデベロッパーツール（F12）を開く
- デバイスツールバーをオンにして「カスタムサイズ」を選択
- 幅: 2500px、高さ: 1686pxに設定
- スクリーンショット機能で画像を保存

### 2. 画像の配置

撮影した画像を以下の場所に配置します：

```bash
apps/rich_menu/images/
├── richmenu_page1.png
└── richmenu_page2.png
```

### 3. リッチメニューの作成

LINE Botのトーク画面で以下のコマンドを実行：

```
?メニュー作成
```

これにより、以下の処理が自動的に実行されます：
1. 既存のリッチメニューを削除
2. 新しいメニューを2つ作成（ページ1とページ2）
3. 画像をアップロード
4. ヒットボックス（タップ領域）を設定
5. デフォルトメニューを設定（ページ1）

## 📋 管理コマンド

| コマンド | 機能 |
|---------|------|
| `?メニュー作成` | リッチメニューを作成（画像必須） |
| `?メニュー削除` | 全てのリッチメニューを削除 |
| `?メニュー状態` | 現在の状態を確認 |

## 🎯 ヒットボックス定義

### ページ1のヒットボックス

| エリア | 座標 | アクション |
|-------|------|----------|
| 💰 銀行 | (0, 0, 833, 843) | `action=banking_home` |
| 🛒 ショップ | (833, 0, 833, 843) | `action=shop_home` |
| 📈 株式 | (1666, 0, 834, 843) | `action=stock_home` |
| ▶️ 次へ | (1666, 843, 834, 843) | `action=richmenu_page&page=2` |

### ページ2のヒットボックス

| エリア | 座標 | アクション |
|-------|------|----------|
| 🎮 ゲーム | (0, 0, 833, 843) | `action=game_home` |
| 💼 労働 | (833, 0, 833, 843) | `action=work_home` |
| ❓ ヘルプ | (1666, 0, 834, 843) | `action=help_home` |
| ◀️ 前へ | (0, 843, 833, 843) | `action=richmenu_page&page=1` |

## 🔧 カスタマイズ

### メニューテンプレートの編集

`menu_templates.py`を編集することで、ヒットボックスやアクションを変更できます：

```python
def get_page1_template():
    return {
        "size": {"width": 2500, "height": 1686},
        "selected": True,
        "name": "メインメニュー（ページ1）",
        "chatBarText": "メニュー",
        "areas": [
            {
                "bounds": {"x": 0, "y": 0, "width": 833, "height": 843},
                "action": {
                    "type": "postback",
                    "data": "action=banking_home",
                    "displayText": "💰 銀行"
                }
            },
            # ... 他のエリア
        ]
    }
```

### 画像の変更

1. HTMLファイルのCSSを編集してデザインを変更
2. 新しいスクリーンショットを撮影
3. `images/`ディレクトリに上書き保存
4. `?メニュー作成`で再作成

## 📌 postbackアクション一覧

| アクション | 処理内容 |
|----------|---------|
| `action=banking_home` | 口座情報を表示 |
| `action=shop_home` | ショップホームを表示 |
| `action=stock_home` | 株式ダッシュボードを表示 |
| `action=game_home` | ゲームメニューを表示 |
| `action=work_home` | 労働システムを実行 |
| `action=help_home` | ヘルプを表示 |
| `action=richmenu_page&page=1` | ページ1に切り替え |
| `action=richmenu_page&page=2` | ページ2に切り替え |

## ⚠️ トラブルシューティング

### メニューが表示されない

1. 画像ファイルが正しい場所に配置されているか確認
2. 画像サイズが**2500x1686px**であることを確認
3. LINE アプリを再起動
4. `?メニュー状態`でメニューIDが作成されているか確認

### 画像が見つからないエラー

```
❌ エラーが発生しました
画像ファイルが apps/rich_menu/images/ に配置されているか確認してください。
```

→ `apps/rich_menu/images/`ディレクトリに`richmenu_page1.png`と`richmenu_page2.png`を配置してください。

### タップしても反応しない

1. ヒットボックスの座標が画像と一致しているか確認
2. postbackアクションが`apps/auto_reply.py`に登録されているか確認
3. コンソールログでエラーが出ていないか確認

## 🔄 更新フロー

メニューを更新する際の手順：

1. HTMLファイルを編集してデザインを変更
2. 新しいスクリーンショットを撮影
3. `images/`に上書き保存
4. `?メニュー作成`を実行（自動的に古いメニューを削除して再作成）

## 📝 注意事項

- リッチメニューは**個別チャット専用**です（グループチャットでは表示されません）
- 画像サイズは厳密に**2500x1686px**である必要があります
- 1つのLINE Botアカウントに複数のリッチメニューを作成できますが、ユーザーに表示されるのは1つだけです
- メニュー切り替え時は`linkRichMenuToUser` APIでユーザーごとに切り替えます

## 🌟 今後の拡張案

- [ ] 3ページ目の追加（ユーティリティ機能など）
- [ ] ユーザー権限別メニュー（管理者用メニュー）
- [ ] 時間帯別メニュー（朝・昼・夜でデザイン変更）
- [ ] イベント期間限定メニュー
- [ ] A/Bテスト用の複数デザイン

---

**開発者:** GitHub Copilot  
**バージョン:** 1.0.0  
**最終更新:** 2025年12月5日
